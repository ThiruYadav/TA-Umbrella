# EVERYTHING UNTESTED

[opendns:dnslog]
EVAL-vendor = "Cisco"
EVAL-product = "Umbrella"

# I guess this is needed
INDEXED_EXTRACTIONS = csv
KV_MODE = none

# Only required if you don't have headers extracted
REPORT-opendns-fields_fallback = opendns_aws_s3

# https://support.umbrella.com/hc/en-us/articles/231248508-Log-Management-Export-Format
# Timestamp
#   When this request was made in UTC.  Note: This is different than the Umbrella dashboard, which converts the time to your specified time zone.
# Most Granular Identity
#   The first identity matched with this request in order of granularity. The order of granularity is Roaming Computers or Mobile Devices first, then AD Users, AD Computers, and Sites and Networks. The most granular identity to match this request is listed here.
FIELDALIAS-user = 'Most Granular Identity' AS user, Most_Granular_Identity AS user
# Identities	
#   All identities associated with this request in order of the first matched against your policy hierarchy.
EVAL-identities = split(Identities,",")
# InternalIp	
#   The internal IP address that made the request.
FIELDALIAS-dest = InternalIP AS dest
# ExternalIp	
#   The external IP address that made the request.
# Action	
#   Whether the request was allowed or blocked.
# TODO: EVAL this with a case
FIELDALIAS-action = Action AS action

# QueryType	
#   The type of DNS request that was made. For details, see here: https://support.umbrella.com/hc/en-us/articles/232252848
REPORT-opendns_extract_record_type = opendns_extract_record_type
# ResponseCode	
#   The DNS return code for this request. For details, see here: https://support.umbrella.com/hc/en-us/articles/232254248
FIELDALIAS-reply_code = ResponseCode AS reply_code
# Domain	
#   The domain that was requested.
FIELDALIAS-query = Domain AS query
# Categories	
#   Information about the security category or content category of the domain requested, e.g. "Search Engines", "Malware", "Blogs", etc. The category may also match your custom destination lists. The complete list of categories can be found here: https://api.opendns.com/v3/categories
# TODO: Add CIM field aliases
EVAL-categories = split(Categories,",")

LOOKUP-opendns_category = opendns_categories name AS categories OUTPUT blockGroup,description
